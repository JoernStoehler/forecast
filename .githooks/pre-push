#!/usr/bin/env bash
# Heavier checks before pushing. Skippable with `--no-verify` or SKIP_HOOKS=1
set -euo pipefail

if [[ "${SKIP_HOOKS:-}" == "1" ]]; then
  echo "[hooks] pre-push skipped (SKIP_HOOKS=1)"
  exit 0
fi

echo "[hooks] pyright type-check"
~/.local/bin/uvx pyright -p pyrightconfig.json

echo "[hooks] pytest"
~/.local/bin/uv run -m pytest -q

if [[ -f frontend/package.json ]]; then
  echo "[hooks] frontend type-check"
  pnpm -C frontend tsc --noEmit
  echo "[hooks] frontend tests"
  pnpm -C frontend test --silent
fi

echo "[hooks] OK"
